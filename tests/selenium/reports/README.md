# Test Reports Directory

This is the **single unified location** for all test reports and test-related outputs in the AI Cooking Assistant project.

## 📊 Contents

### Generated Reports

- **`final_beautiful_report.html`** - Main HTML test report with modern styling
  - Generated by: `pytest --html=...`
  - Includes: Pass/fail stats, donut chart, AI response excerpts
  - Auto-updated on each test run

- **`ai_responses.jsonl`** - JSONL log of AI responses from tests
  - One JSON object per line
  - Includes: test name, prompt, response, timestamp

- **`flask_server.log`** - Flask application startup log
  - Useful for debugging server issues during tests

### Directories

- **`screenshots/`** - Test failure screenshots
  - Automatically captured by Selenium tests on failure
  - Timestamped filenames

- **`assets/`** - CSS and styling assets
  - Custom stylesheets for HTML reports
  - Moved from root `/reports/assets/`

- **`archive/`** - Old HTML reports (for reference)
  - Historical reports from previous test runs
  - Not auto-cleaned

## 🚀 Generating Reports

### Full Test Suite with HTML Report

```bash
# Activate virtual environment
source venv/bin/activate

# Run all tests and generate beautiful HTML report
python -m pytest tests/ \\
  --html=tests/selenium/reports/test_report_$(date +%Y%m%d).html \\
  --self-contained-html \\
  -v
```

### Unit Tests Only

```bash
python -m pytest tests/unit/ \\
  --html=tests/selenium/reports/unit_test_report.html \\
  --self-contained-html
```

### Selenium Tests Only

```bash
python -m pytest tests/selenium/ \\
  --html=tests/selenium/reports/selenium_test_report.html \\
  --self-contained-html
```

## 📋 Exporting Test Cases to Excel

To export all test cases (both Selenium and Unit) to Excel:

```bash
python tests/utils/export_test_cases.py
```

Output: `tests/selenium/reports/All_Test_Cases.xlsx`

This creates an Excel workbook with:
- Summary sheet (test counts)
- Selenium tests sheet
- Unit tests sheet

## 🎨 Report Features

### Modern Styling
- ✅ Color-coded test results (green/red/yellow)
- ✅ Smooth hover animations
- ✅ Pass-rate donut chart
- ✅ Dark code blocks for logs
- ✅ Responsive layout

### AI Response Tracking
- Captures AI prompts and responses
- Displays excerpts in expandable sections
- Logs full responses to JSONL for analysis

### Screenshot Capture
- Auto-captures on test failure
- Embedded in HTML report
- Saved to `screenshots/` directory

## 🧹 Maintenance

### Cleaning Old Reports

```bash
# Remove all HTML reports except the latest
find tests/selenium/reports/ -name "*.html" -type f ! -name "final_beautiful_report.html" -delete

# Clean up old screenshots (older than 30 days)
find tests/selenium/reports/screenshots/ -type f -mtime +30 -delete

# Clear JSONL log
> tests/selenium/reports/ai_responses.jsonl
```

### Archive Management

Old reports are automatically moved to `archive/` by the cleanup scripts. You can safely delete these after review:

```bash
rm -rf tests/selenium/reports/archive/*
```

## 📝 Report Hooks

Test reporting is enhanced by `tests/selenium/report_hooks.py`:
- Adds custom CSS styling
- Injects AI response data
- Creates pass-rate visualization
- Logs test metadata to JSONL

This plugin is registered in the root `conftest.py`:
```python
pytest_plugins = ["tests.selenium.report_hooks"]
```

## 🔧 Troubleshooting

### Report Not Generating

1. Check pytest-html is installed:
   ```bash
   pip install pytest-html
   ```

2. Ensure output directory exists:
   ```bash
   mkdir -p tests/selenium/reports
   ```

### Screenshots Missing

- Check Selenium WebDriver is configured in `tests/selenium/conftest.py`
- Ensure `SCREEN_DIR` path is correct

### AI Responses Not Logged

- Check that tests set `request.node.response_excerpt`
- Verify `pytest_configure` creates JSONL file
- Check file permissions on `ai_responses.jsonl`

## 📚 Related Files

- `/conftest.py` - Root pytest configuration, registers report hooks
- `/tests/selenium/conftest.py` - Selenium fixtures and screenshot capture
- `/tests/selenium/report_hooks.py` - Custom report styling and AI logging
- `/tests/utils/export_test_cases.py` - Excel export utility

---

**Last Updated:** October 27, 2025
**Version:** 2.0 (Unified Architecture)
